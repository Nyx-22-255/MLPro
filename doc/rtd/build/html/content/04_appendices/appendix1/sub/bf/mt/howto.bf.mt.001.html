<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Howto BF-MT-001: Multitasking - Parallel Algorithms &mdash; MLPro Documentations 1.0.0 documentation</title><link rel="stylesheet" href="../../../../../../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../../../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../../_static/custom.css" type="text/css" /><link rel="shortcut icon" href="../../../../../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="../../../../../../" src="../../../../../../_static/documentation_options.js"></script>
        <script src="../../../../../../_static/jquery.js"></script>
        <script src="../../../../../../_static/underscore.js"></script>
        <script src="../../../../../../_static/doctools.js"></script>
        <script src="../../../../../../_static/language_data.js"></script>
        <script src="../../../../../../_static/clipboard.min.js"></script>
        <script src="../../../../../../_static/copybutton.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script src="../../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../../search.html" />
    <link rel="next" title="Howto BF-MT-002: Multitasking - Tasks and Workflows" href="howto.bf.mt.002.html" />
    <link rel="prev" title="Howto BF-EH-001: Event Handling" href="../eh/howto.bf.eh.001.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../../../../index.html" class="icon icon-home"> MLPro Documentations<img src="../../../../../../_static/logo_mlpro.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Welcome to MLPro</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../01_welcome/sub/01_introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../01_welcome/sub/02_getting_started.html">2. Getting Started</a></li>
</ul>
<p class="caption"><span class="caption-text">Basic Functions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../02_basic_functions/mlpro_bf/main.html">7. MLPro-BF - Basic Functions</a></li>
</ul>
<p class="caption"><span class="caption-text">Machine Learning</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../03_machine_learning/mlpro_sl/main.html">8. MLPro-SL - Supervised Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../03_machine_learning/mlpro_rl/main.html">9. MLPro-RL - Reinforcement Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../03_machine_learning/mlpro_gt/main.html">10. MLPro-GT - Game Theory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../03_machine_learning/mlpro_oa/main.html">11. MLPro-OA - Online Adaptivity</a></li>
</ul>
<p class="caption"><span class="caption-text">Appendices</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../../main.html">A1 - Example Pool</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../01_howto.bf.html">Basic Functions</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../01_howto.bf.html#elementary-topics">Elementary Topics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../01_howto.bf.html#event-handling">Event Handling</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../../01_howto.bf.html#multitasking">Multitasking</a><ul class="current">
<li class="toctree-l4 current"><a class="current reference internal" href="#">Howto BF-MT-001: Multitasking - Parallel Algorithms</a></li>
<li class="toctree-l4"><a class="reference internal" href="howto.bf.mt.002.html">Howto BF-MT-002: Multitasking - Tasks and Workflows</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../01_howto.bf.html#mathematics">Mathematics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../01_howto.bf.html#data-stream-processing">Data Stream Processing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../01_howto.bf.html#machine-learning">Machine Learning</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../01_howto.bf.html#systems">Systems</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../01_howto.bf.html#user-interaction">User Interaction</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../02_howto.rl.html">Reinforcement Learning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_howto.gt.html">Game Theory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../04_howto.oa.html">Online Adaptivity</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../appendix2/main.html">A2 - API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../appendix3/main.html">A3 - Project MLPro</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../../index.html">MLPro Documentations</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../../main.html">A1 - Example Pool</a> &raquo;</li>
          <li><a href="../../01_howto.bf.html">Basic Functions</a> &raquo;</li>
      <li>Howto BF-MT-001: Multitasking - Parallel Algorithms</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/fhswf/MLPro/blob/main/doc/docs/content/04_appendices/appendix1/sub/bf/mt/howto.bf.mt.001.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="module-mlpro.bf.examples.howto_bf_mt_001_parallel_algorithms">
<span id="howto-bf-mt-001-multitasking-parallel-algorithms"></span><h1>Howto BF-MT-001: Multitasking - Parallel Algorithms<a class="headerlink" href="#module-mlpro.bf.examples.howto_bf_mt_001_parallel_algorithms" title="Permalink to this headline">¶</a></h1>
<p>Ver. 1.3.0 (2022-10-13)</p>
<p>This module demonstrates the use of classes ASync and Shared as part of MLPro’s multitasking concept.
Both classes are used to implement a simple parallel algorithm class MyParallelAlgorithm with a
method _async_subtask() for asynchronous execution collecting results in a shared object.</p>
<p>In three runs method _async_subtask() is executed several times a) synchronously, b) as threads and
c) as processes. Depending on the number of cores per cpu, the operating system, and further factors
multiprocessing outperforms multithreading more ore less drastically. Method MyParallelAlgoritm.execute()
determines and logs the speed factor of multithreading and multiprocessing in comparison to serial/synchronous
computation. Open the perfmeter of your system and play with number of tasks and their duration to observe
the behavior.</p>
<p>All sub-tasks store dummy results in a shared object. It is no surprise that the order of result entries
in multithreading and multiprocessing mode does not 100% match the order of sub-task starts.</p>
<p>You will learn:</p>
<ol class="arabic simple">
<li><p>The meaning and basic properties of the classes Async and Shared.</p></li>
<li><p>How to set up an own class with parallel running sub-tasks inside.</p></li>
<li><p>How to collect results of the parallel sub-functions in a shared object.</p></li>
</ol>
<div class="section" id="executable-code">
<h2>Executable code<a class="headerlink" href="#executable-code" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">## -------------------------------------------------------------------------------------------------</span>
<span class="c1">## -- Project : MLPro - A Synoptic Framework for Standardized Machine Learning Tasks</span>
<span class="c1">## -- Package : mlpro.bf.examples</span>
<span class="c1">## -- Module  : howto_bf_mt_001_parallel_algorithms.py</span>
<span class="c1">## -------------------------------------------------------------------------------------------------</span>
<span class="c1">## -- History :</span>
<span class="c1">## -- yyyy-mm-dd  Ver.      Auth.    Description</span>
<span class="c1">## -- 2022-10-03  1.0.0     DA       Creation/release</span>
<span class="c1">## -- 2022-10-09  1.1.0     DA       Simplification</span>
<span class="c1">## -- 2022-10-12  1.2.0     DA       Restructuring of demo steps</span>
<span class="c1">## -- 2022-10-13  1.3.0     DA       Restructuring of demo steps</span>
<span class="c1">## -------------------------------------------------------------------------------------------------</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Ver. 1.3.0 (2022-10-13)</span>

<span class="sd">This module demonstrates the use of classes ASync and Shared as part of MLPro&#39;s multitasking concept.</span>
<span class="sd">Both classes are used to implement a simple parallel algorithm class MyParallelAlgorithm with a</span>
<span class="sd">method _async_subtask() for asynchronous execution collecting results in a shared object.</span>

<span class="sd">In three runs method _async_subtask() is executed several times a) synchronously, b) as threads and </span>
<span class="sd">c) as processes. Depending on the number of cores per cpu, the operating system, and further factors </span>
<span class="sd">multiprocessing outperforms multithreading more ore less drastically. Method MyParallelAlgoritm.execute() </span>
<span class="sd">determines and logs the speed factor of multithreading and multiprocessing in comparison to serial/synchronous </span>
<span class="sd">computation. Open the perfmeter of your system and play with number of tasks and their duration to observe </span>
<span class="sd">the behavior.</span>

<span class="sd">All sub-tasks store dummy results in a shared object. It is no surprise that the order of result entries</span>
<span class="sd">in multithreading and multiprocessing mode does not 100% match the order of sub-task starts.</span>

<span class="sd">You will learn:</span>

<span class="sd">1) The meaning and basic properties of the classes Async and Shared.</span>

<span class="sd">2) How to set up an own class with parallel running sub-tasks inside.</span>

<span class="sd">3) How to collect results of the parallel sub-functions in a shared object.</span>

<span class="sd">&quot;&quot;&quot;</span>


<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">from</span> <span class="nn">mlpro.bf.various</span> <span class="kn">import</span> <span class="n">Log</span>
<span class="kn">import</span> <span class="nn">multiprocess</span> <span class="k">as</span> <span class="nn">mp</span>
<span class="kn">import</span> <span class="nn">mlpro.bf.mt</span> <span class="k">as</span> <span class="nn">mt</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">from</span> <span class="nn">cmath</span> <span class="kn">import</span> <span class="n">pi</span><span class="p">,</span> <span class="n">sin</span><span class="p">,</span> <span class="n">cos</span><span class="p">,</span> <span class="n">tan</span>
<span class="kn">import</span> <span class="nn">random</span>



<span class="c1">## -------------------------------------------------------------------------------------------------</span>
<span class="c1">## -------------------------------------------------------------------------------------------------</span>
<span class="k">class</span> <span class="nc">MyParallelAlgorithm</span> <span class="p">(</span><span class="n">mt</span><span class="o">.</span><span class="n">Async</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class demonstrates how to run methods asynchronously and to collect results in a shared</span>
<span class="sd">    object.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># needed for proper logging (see class mlpro.bf.various.Log)</span>
    <span class="n">C_TYPE</span>      <span class="o">=</span> <span class="s1">&#39;Demo&#39;</span>
    <span class="n">C_NAME</span>      <span class="o">=</span> <span class="s1">&#39;Parallel Algorithm&#39;</span>

<span class="c1">## -------------------------------------------------------------------------------------------------</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> 
                  <span class="n">p_num_tasks</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span>
                  <span class="n">p_duration</span><span class="p">:</span><span class="n">timedelta</span><span class="p">,</span>
                  <span class="n">p_range_max</span><span class="o">=</span><span class="n">mt</span><span class="o">.</span><span class="n">Async</span><span class="o">.</span><span class="n">C_RANGE_PROCESS</span><span class="p">,</span> 
                  <span class="n">p_class_shared</span><span class="o">=</span><span class="n">mt</span><span class="o">.</span><span class="n">Shared</span><span class="p">,</span>
                  <span class="n">p_logging</span><span class="o">=</span><span class="n">Log</span><span class="o">.</span><span class="n">C_LOG_ALL</span> <span class="p">):</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span> <span class="n">p_range_max</span><span class="o">=</span><span class="n">p_range_max</span><span class="p">,</span> 
                          <span class="n">p_class_shared</span><span class="o">=</span><span class="n">p_class_shared</span><span class="p">,</span> 
                          <span class="n">p_logging</span><span class="o">=</span><span class="n">p_logging</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_num_tasks</span>    <span class="o">=</span> <span class="n">p_num_tasks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_duration</span>     <span class="o">=</span> <span class="n">p_duration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_duration_sec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_duration</span><span class="o">.</span><span class="n">seconds</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_duration</span><span class="o">.</span><span class="n">microseconds</span> <span class="o">/</span> <span class="mi">1000000</span>


<span class="c1">## -------------------------------------------------------------------------------------------------</span>
    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Log at the beginning of a run</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_range</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">C_RANGE_NONE</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">Log</span><span class="o">.</span><span class="n">C_LOG_TYPE_S</span><span class="p">,</span> <span class="s1">&#39;Execution of&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_tasks</span><span class="p">,</span> <span class="s1">&#39;synchronous tasks started&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_range</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">C_RANGE_THREAD</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">Log</span><span class="o">.</span><span class="n">C_LOG_TYPE_S</span><span class="p">,</span> <span class="s1">&#39;Execution of&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_tasks</span><span class="p">,</span> <span class="s1">&#39;asynchronous tasks as threads started&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">Log</span><span class="o">.</span><span class="n">C_LOG_TYPE_S</span><span class="p">,</span> <span class="s1">&#39;Execution of&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_tasks</span><span class="p">,</span> <span class="s1">&#39;asynchronous tasks as processes started&#39;</span><span class="p">)</span>

        <span class="c1"># Start number of tasks (a)synchronously</span>
        <span class="n">time_start</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_tasks</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_start_async</span><span class="p">(</span> <span class="n">p_target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_async_subtask</span><span class="p">,</span> <span class="n">p_tid</span><span class="o">=</span><span class="n">t</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">wait_async_tasks</span><span class="p">()</span>
        <span class="n">time_end</span>   <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

        <span class="c1"># Determination of speed factor (no parallelism = 1)</span>
        <span class="n">duration_real</span>       <span class="o">=</span> <span class="n">time_end</span> <span class="o">-</span> <span class="n">time_start</span> 
        <span class="n">duration_real_sec</span>   <span class="o">=</span> <span class="n">duration_real</span><span class="o">.</span><span class="n">seconds</span> <span class="o">+</span> <span class="n">duration_real</span><span class="o">.</span><span class="n">microseconds</span> <span class="o">/</span> <span class="mi">1000000</span>
        <span class="n">speed_factor</span>        <span class="o">=</span> <span class="nb">round</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_tasks</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_duration_sec</span> <span class="o">/</span> <span class="n">duration_real_sec</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Log of speed factor </span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_range</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">C_RANGE_NONE</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">Log</span><span class="o">.</span><span class="n">C_LOG_TYPE_S</span><span class="p">,</span> <span class="s1">&#39;Execution of&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_tasks</span><span class="p">,</span> <span class="s1">&#39;synchronous tasks ended (speed factor =&#39;</span><span class="p">,</span> <span class="n">speed_factor</span><span class="p">,</span> <span class="s1">&#39;)&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_range</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">C_RANGE_THREAD</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">Log</span><span class="o">.</span><span class="n">C_LOG_TYPE_S</span><span class="p">,</span> <span class="s1">&#39;Execution of&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_tasks</span><span class="p">,</span> <span class="s1">&#39;asynchronous tasks as threads ended (speed factor =&#39;</span><span class="p">,</span> <span class="n">speed_factor</span><span class="p">,</span> <span class="s1">&#39;)&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">Log</span><span class="o">.</span><span class="n">C_LOG_TYPE_S</span><span class="p">,</span> <span class="s1">&#39;Execution of&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_tasks</span><span class="p">,</span> <span class="s1">&#39;asynchronous tasks as processes ended (speed factor =&#39;</span><span class="p">,</span> <span class="n">speed_factor</span><span class="p">,</span> <span class="s1">&#39;)&#39;</span><span class="p">)</span>

        <span class="c1"># Log of results collected in the shared object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">Log</span><span class="o">.</span><span class="n">C_LOG_TYPE_I</span><span class="p">,</span> <span class="s1">&#39;Results in shared object are:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_so</span><span class="o">.</span><span class="n">get_results</span><span class="p">())</span>


<span class="c1">## -------------------------------------------------------------------------------------------------</span>
    <span class="k">def</span> <span class="nf">_async_subtask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_tid</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">Log</span><span class="o">.</span><span class="n">C_LOG_TYPE_I</span><span class="p">,</span> <span class="s1">&#39;Task&#39;</span><span class="p">,</span> <span class="n">p_tid</span><span class="p">,</span> <span class="s1">&#39;started&#39;</span><span class="p">)</span>

        <span class="c1"># 1 Sub-task needs to check in on shared object        </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_so</span><span class="o">.</span><span class="n">checkin</span><span class="p">(</span> <span class="n">p_tid</span><span class="o">=</span><span class="n">p_tid</span> <span class="p">)</span>

        <span class="c1"># 2 Dummy implementation to simulate a busy sub-task</span>
        <span class="n">time_start</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="n">result</span>     <span class="o">=</span> <span class="mi">0</span>

        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># do something meaningful</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">300</span><span class="p">):</span> 
                <span class="n">result</span> <span class="o">+=</span> <span class="n">sin</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">*</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">*</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="n">tan</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">*</span><span class="n">pi</span><span class="p">)</span>

            <span class="n">time_current</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
            <span class="n">time_diff</span>    <span class="o">=</span> <span class="n">time_current</span> <span class="o">-</span> <span class="n">time_start</span>
            <span class="k">if</span> <span class="n">time_diff</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_duration</span><span class="p">:</span> <span class="k">break</span>

        <span class="c1"># 3 Sub-task can optionally store resuls in the shared object.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_so</span><span class="o">.</span><span class="n">add_result</span><span class="p">(</span><span class="n">p_tid</span><span class="o">=</span><span class="n">p_tid</span><span class="p">,</span> <span class="n">p_result</span><span class="o">=</span><span class="n">result</span><span class="p">)</span>

        <span class="c1"># 4 Sub-task needs to check out from shared object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_so</span><span class="o">.</span><span class="n">checkout</span><span class="p">(</span> <span class="n">p_tid</span><span class="o">=</span><span class="n">p_tid</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">Log</span><span class="o">.</span><span class="n">C_LOG_TYPE_I</span><span class="p">,</span> <span class="s1">&#39;Task&#39;</span><span class="p">,</span> <span class="n">p_tid</span><span class="p">,</span> <span class="s1">&#39;stopped&#39;</span><span class="p">)</span>





<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>

    <span class="c1"># 1 Preparation of execution</span>

    <span class="c1"># https://docs.python.org/3/library/multiprocessing.html?highlight=freeze_support#multiprocessing.freeze_support</span>
    <span class="n">mp</span><span class="o">.</span><span class="n">freeze_support</span><span class="p">()</span>

    <span class="n">num_tasks</span>   <span class="o">=</span> <span class="mi">20</span>
    <span class="n">duration</span>    <span class="o">=</span> <span class="n">timedelta</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">pause_sec</span>   <span class="o">=</span> <span class="mi">5</span>
    <span class="n">logging</span>     <span class="o">=</span> <span class="n">Log</span><span class="o">.</span><span class="n">C_LOG_ALL</span>



    <span class="c1"># 2 Execution of demo class (synchronously)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">MyParallelAlgorithm</span><span class="p">(</span> <span class="n">p_num_tasks</span> <span class="o">=</span> <span class="n">num_tasks</span><span class="p">,</span> 
                             <span class="n">p_duration</span> <span class="o">=</span> <span class="n">duration</span><span class="p">,</span> 
                             <span class="n">p_range_max</span> <span class="o">=</span> <span class="n">mt</span><span class="o">.</span><span class="n">Async</span><span class="o">.</span><span class="n">C_RANGE_NONE</span><span class="p">,</span> 
                             <span class="n">p_logging</span> <span class="o">=</span> <span class="n">logging</span> <span class="p">)</span>
                                
    <span class="n">a</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>                     



    <span class="c1"># 3 Execution of demo class (asynchonously, multithreading)</span>
    <span class="n">a</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">Log</span><span class="o">.</span><span class="n">C_LOG_TYPE_W</span><span class="p">,</span> <span class="s1">&#39;Short break for better observation of CPU load in perfmeter&#39;</span><span class="p">)</span>
    <span class="n">sleep</span><span class="p">(</span><span class="n">pause_sec</span><span class="p">)</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">MyParallelAlgorithm</span><span class="p">(</span> <span class="n">p_num_tasks</span> <span class="o">=</span> <span class="n">num_tasks</span><span class="p">,</span> 
                             <span class="n">p_duration</span> <span class="o">=</span> <span class="n">duration</span><span class="p">,</span> 
                             <span class="n">p_range_max</span> <span class="o">=</span> <span class="n">mt</span><span class="o">.</span><span class="n">Async</span><span class="o">.</span><span class="n">C_RANGE_THREAD</span><span class="p">,</span> 
                             <span class="n">p_logging</span> <span class="o">=</span> <span class="n">logging</span> <span class="p">)</span>

    <span class="n">a</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>



    <span class="c1"># 4 Execution of demo class (asynchronously, multiprocessing)</span>
    <span class="n">a</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">Log</span><span class="o">.</span><span class="n">C_LOG_TYPE_W</span><span class="p">,</span> <span class="s1">&#39;Short break for better observation of CPU load in perfmeter&#39;</span><span class="p">)</span>
    <span class="n">sleep</span><span class="p">(</span><span class="n">pause_sec</span><span class="p">)</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">MyParallelAlgorithm</span><span class="p">(</span> <span class="n">p_num_tasks</span> <span class="o">=</span> <span class="n">num_tasks</span><span class="p">,</span> 
                             <span class="n">p_duration</span> <span class="o">=</span> <span class="n">duration</span><span class="p">,</span> 
                             <span class="n">p_range_max</span> <span class="o">=</span> <span class="n">mt</span><span class="o">.</span><span class="n">Async</span><span class="o">.</span><span class="n">C_RANGE_PROCESS</span><span class="p">,</span> 
                             <span class="n">p_logging</span> <span class="o">=</span> <span class="n">logging</span> <span class="p">)</span>
                            
    <span class="n">a</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>                     
</pre></div>
</div>
</div>
<div class="section" id="results">
<h2>Results<a class="headerlink" href="#results" title="Permalink to this headline">¶</a></h2>
<p>The howto example logs details of the three runs and in particular the speed factors of multithreading and
multiprocessing in comparison to the serial/synchronous execution. On a PC with an AMD Ryzen 7 CPU (8/16 cores)
running Linux, the system monitor shows an approx. 5x speedup with multithreading and an approx. 18x speedup with multiprocessing.</p>
<img alt="../../../../../../_images/howto_bf_mt_001_parallel_algorithms.png" src="../../../../../../_images/howto_bf_mt_001_parallel_algorithms.png" />
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../eh/howto.bf.eh.001.html" class="btn btn-neutral float-left" title="Howto BF-EH-001: Event Handling" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="howto.bf.mt.002.html" class="btn btn-neutral float-right" title="Howto BF-MT-002: Multitasking - Tasks and Workflows" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022 South Westphalia University of Applied Sciences, Germany.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>